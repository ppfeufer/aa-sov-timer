$(document).ready(()=>{'use strict';const a='undefined'!=typeof sovtimerJsSettingsOverride?objectDeepMerge(sovtimerJsSettingsDefaults,sovtimerJsSettingsOverride):sovtimerJsSettingsDefaults,e={campaignsTotal:$('.aa-sovtimer-campaigns-total'),campaignsUpcoming:$('.aa-sovtimer-campaigns-upcoming'),campaignsActive:$('.aa-sovtimer-campaigns-active')},t=({selector:a='body',namespace:e='aa-sovtimer'})=>{document.querySelectorAll(`${a} [data-bs-tooltip="${e}"]`).forEach(a=>{const e=bootstrap.Tooltip.getInstance(a);return e&&e.dispose(),$('.bs-tooltip-auto').remove(),new bootstrap.Tooltip(a)})},n=(a,e=1)=>{const t=JSON.parse(JSON.stringify(a));return t[e]&&(t[e].content=[]),t},o=a=>{const e=a<0,t=e?'-':'',n='aa-sovtimer-remaining'+(e?' aa-sovtimer-timer-elapsed':'');a=Math.abs(a)+(e?1:-1);return{countdown:`<span class="${n}">${t}${Math.floor(a/86400)}d ${String(Math.floor(a/3600)%24).padStart(2,'0')}h ${String(Math.floor(a/60)%60).padStart(2,'0')}m ${String(Math.floor(a)%60).padStart(2,'0')}s</span>`,remainingTimeInSeconds:t+a}},r=t=>{const n=t.reduce((e,t)=>(e.total++,t.active_campaign===a.translation.no&&t.remaining_time_in_seconds<=a.upcomingTimerThreshold&&e.upcoming++,t.active_campaign===a.translation.yes&&e.active++,e),{total:0,upcoming:0,active:0});e.campaignsTotal.html(n.total),e.campaignsUpcoming.html(n.upcoming),e.campaignsActive.html(n.active)},i=$('.aa-sovtimer-campaigns');fetchGet({url:a.url.ajaxUpdate}).then(e=>{if(!e)return;new DataTable(i,{language:{url:a.dataTables.languageUrl},data:e,dom:a.dataTables.dom,ordering:a.dataTables.ordering,columnControl:a.dataTables.columnControl,columns:[{data:{display:a=>a.solar_system_name_html,sort:a=>a.solar_system_name,filter:a=>a.solar_system_name}},{data:{display:a=>a.constellation_name_html,sort:a=>a.constellation_name,filter:a=>a.constellation_name}},{data:{display:a=>a.region_name_html,sort:a=>a.region_name,filter:a=>a.region_name}},{data:{display:a=>a.defender_name_html,sort:a=>a.defender_name,filter:a=>a.defender_name}},{data:'adm'},{data:{display:e=>e.start_time?moment(e.start_time).utc().format(a.datetimeFormat.datetimeLong):'',sort:a=>a.start_time||'',filter:a=>a.start_time||''}},{data:{display:a=>a.remaining_time,sort:a=>parseInt(a.remaining_time_in_seconds,10),filter:a=>parseInt(a.remaining_time_in_seconds,10)}},{data:{display:a=>a.campaign_progress,sort:a=>a.campaign_progress,filter:a=>a.active_campaign}}],columnDefs:[{targets:[4,5,6,7],columnControl:n(a.dataTables.columnControl,1)},{target:6,type:'string',width:175},{target:7,type:'string',width:175}],order:[[5,'asc']],createdRow:(e,t)=>{t.active_campaign===a.translation.no&&t.remaining_time_in_seconds<=a.upcomingTimerThreshold&&$(e).addClass('aa-sovtimer-upcoming-campaign'),t.active_campaign===a.translation.yes&&$(e).addClass('aa-sovtimer-active-campaign')},paging:!1,initComplete:()=>{const e=i.DataTable();r(e.rows().data().toArray()),t({selector:'.aa-sovtimer'});let n=e.rows().indexes().toArray().map(a=>{const t=e.row(a).data();return{rowIdx:a,cellNode:e.cell(a,6).node(),remainingSeconds:Number(t.remaining_time_in_seconds)}});const s=()=>{n=e.rows().indexes().toArray().map(a=>{const t=e.row(a).data();return{rowIdx:a,cellNode:e.cell(a,6).node(),remainingSeconds:Number(t.remaining_time_in_seconds)}})};setInterval(()=>{for(let a=0;a<n.length;a++){const e=n[a];e.remainingSeconds=Number(e.remainingSeconds)-1;const t=o(e.remainingSeconds);e.cellNode&&(e.cellNode.innerHTML=t.countdown)}},1e3),setInterval(()=>{fetchGet({url:a.url.ajaxUpdate}).then(a=>{e.clear().rows.add(a).draw(),r(a),t({selector:'.aa-sovtimer'})}).catch(console.error)},3e4),e.on('draw',()=>{s(),r(e.rows().data().toArray()),t({selector:'.aa-sovtimer'})})}})}).catch(console.error)});
//# sourceMappingURL=aa-sov-timer.min.js.map