$(document).ready(()=>{'use strict';const a='undefined'!=typeof sovtimerJsSettingsOverride?objectDeepMerge(sovtimerJsSettingsDefaults,sovtimerJsSettingsOverride):sovtimerJsSettingsDefaults,t={campaignsTotal:$('.aa-sovtimer-campaigns-total'),campaignsUpcoming:$('.aa-sovtimer-campaigns-upcoming'),campaignsActive:$('.aa-sovtimer-campaigns-active')},e=({selector:a='body',namespace:t='aa-sovtimer'})=>{document.querySelectorAll(`${a} [data-bs-tooltip="${t}"]`).forEach(a=>{const t=bootstrap.Tooltip.getInstance(a);return t&&t.dispose(),$('.bs-tooltip-auto').remove(),new bootstrap.Tooltip(a)})},s=()=>a.dataTables.columnControl.map((a,t)=>1===t?{...a,content:[]}:a),o=a=>{const t=a<0,e=t?'-':'',s='aa-sovtimer-remaining'+(t?' aa-sovtimer-timer-elapsed':'');a=Math.abs(a)+(t?1:-1);return{countdown:`<span class="${s}">${e}${Math.floor(a/86400)}d ${String(Math.floor(a/3600)%24).padStart(2,'0')}h ${String(Math.floor(a/60)%60).padStart(2,'0')}m ${String(Math.floor(a)%60).padStart(2,'0')}s</span>`,remainingTimeInSeconds:e+a}},r=a=>{const e=a.reduce((a,t)=>(a.total++,t.campaign_status&&Object.prototype.hasOwnProperty.call(a,t.campaign_status)&&a[t.campaign_status]++,a),{total:0,upcoming:0,active:0});t.campaignsTotal.html(e.total),t.campaignsUpcoming.html(e.upcoming),t.campaignsActive.html(e.active)},i=$('.aa-sovtimer-campaigns');fetchGet({url:a.url.ajaxUpdate}).then(t=>{if(!t)return;new DataTable(i,{language:{url:a.dataTables.languageUrl},data:t,layout:a.dataTables.layout,ordering:a.dataTables.ordering,columnControl:a.dataTables.columnControl,columns:[{data:{display:a=>a.solar_system.display,sort:a=>a.solar_system.sort,filter:a=>a.solar_system.sort}},{data:{display:a=>a.constellation.display,sort:a=>a.constellation.sort,filter:a=>a.constellation.sort}},{data:{display:a=>a.region.display,sort:a=>a.region.sort,filter:a=>a.region.sort}},{data:{display:a=>a.defender.display,sort:a=>a.defender.sort,filter:a=>a.defender.sort}},{data:'adm'},{data:{display:t=>t.start_time?moment(t.start_time).utc().format(a.datetimeFormat.datetimeLong):'',sort:a=>a.start_time?moment(a.start_time).unix():0,filter:a=>a.start_time||''}},{data:{display:a=>a.remaining_time.display,sort:a=>a.remaining_time.seconds,filter:a=>a.remaining_time.seconds}},{data:{display:a=>a.campaign_progress.display,sort:a=>a.campaign_progress.current,filter:a=>a.campaign_status}}],columnDefs:[{targets:[4,5,6,7],columnControl:s()},{targets:[6,7],type:'float',width:175}],order:[[5,'asc']],createdRow:(a,t)=>{$(a).addClass(`aa-sovtimer-${t.campaign_status}-campaign`)},paging:!1,initComplete:()=>{const t=i.DataTable();let s=t.rows().indexes().toArray().map(a=>{const e=t.row(a).data();return{rowIdx:a,cellNode:t.cell(a,6).node(),remainingSeconds:Number(e.remaining_time.seconds)}});const n=()=>{s=t.rows().indexes().toArray().map(a=>{const e=t.row(a).data();return{rowIdx:a,cellNode:t.cell(a,6).node(),remainingSeconds:Number(e.remaining_time.seconds)}})},l=()=>{for(let a=0;a<s.length;a++){const t=s[a];t.remainingSeconds=Number(t.remainingSeconds)-1;const e=o(t.remainingSeconds);t.cellNode&&(t.cellNode.innerHTML=e.countdown)}},c=(a,e)=>{$(a).click(()=>{$.fn.dataTable.ext.search=[];const s=(a,t,s,o)=>!o||e(o);$.fn.dataTable.ext.search.push(s),$('.aa-sovtimer-filter-active').removeClass('aa-sovtimer-filter-active'),$(a).addClass('aa-sovtimer-filter-active'),t.draw()})};r(t.rows().data().toArray()),e({selector:'.aa-sovtimer'}),n(),l(),setInterval(l,1e3),setInterval(()=>{fetchGet({url:a.url.ajaxUpdate}).then(a=>{t.clear().rows.add(a).draw(),r(a),e({selector:'.aa-sovtimer'})}).catch(console.error)},3e4);[['#aa-sovtimer-filter-total-campaigns',()=>!0],['#aa-sovtimer-filter-upcoming-campaigns',a=>'upcoming'===a.campaign_status],['#aa-sovtimer-filter-active-campaigns',a=>'active'===a.campaign_status]].forEach(([a,t])=>c(a,t)),t.on('draw',()=>{n(),r(t.rows().data().toArray()),e({selector:'.aa-sovtimer'})})}})}).catch(console.error)});
//# sourceMappingURL=aa-sov-timer.min.js.map